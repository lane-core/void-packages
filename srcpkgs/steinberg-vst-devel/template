# Template file for 'steinberg-vst-devel'

pkgname=steinberg-vst-devel
version=3.7.4
revision=1
short_desc="Steinberg's VST SDK"
homepage="https://www.steinberg.net/sdk_downloads/"
hostmakedepends="unzip"
maintainer="lane-brain <lane@mailbox.org>"
_sdkarchive="vst-sdk_3.7.4_build-25_2021-12-16.zip"
_sdk2archive="vstsdk3610_11_06_2018_build_37.zip"
distfiles="https://download.steinberg.net/sdk_downloads/${_sdkarchive}
    https://web.archive.org/web/20181016150224/https://download.steinberg.net/sdk_downloads/${_sdk2archive}"
wrksrc=${pkgname}-${version}
license="custom:Steinberg"
checksum="49b0e46345af323ab84be9df065653b2a6531745dea6f3ac3fb47915df9f3a81
 3e5d1e03955636fa4174486882f75bbcbc318aab2a056ccadeb6bda61ec9d49c"
repository=nonfree

do_extract() {
    mkdir current vst-sdk-3610
    
    cd current
    unzip ${XBPS_SRCDISTDIR}/${pkgname}-${version}/${_sdkarchive}
    
    cd ../vst-sdk-3610
    unzip ${XBPS_SRCDISTDIR}/${pkgname}-${version}/${_sdk2archive}
}

pre_install() {
    cd ${wrksrc}/current/VST_SDK
    cp -r vst2sdk/* vst3sdk
}

do_install() {
    # Install headers
    msg_normal "do_install: $PWD"
    vst_sdk_path="${wrksrc}/current/VST_SDK/vst3sdk"
    vst_legacy_path="${wrksrc}/vst-sdk-3610/VST_SDK"
    header_path="usr/include/vst36"

    mkdir -p ${DESTDIR}/${header_path}
    vcopy ${vst_sdk_path}/* ${header_path}

    mkdir -p ${DESTDIR}/${header_path}/pluginterfaces/vst
    vcopy ${vst_sdk_path}/pluginterfaces/vst ${header_path}/pluginterfaces/vst

    # Install legacy headers from 3.6.7. According to the notes:
    #
    # "The VST2 SDK is not part anymore of the VST3 SDK, you have to use 
    # an older version of the SDK and copy the VST2_SDK folder into the VST_SDK folder."
    vcopy ${vst_legacy_path}/VST2_SDK/pluginterfaces/vst2.x ${header_path}/pluginterfaces

    # Clean up unneeded files/directories
    cd ${DESTDIR}/${header_path}
    rm -r tools bin
}

post_install() {
    vlicense ${vst_sdk_path}/LICENSE.txt
    vlicense ${vst_sdk_path}/VST3_License_Agreement.pdf
	vlicense ${vst_legacy_path}/VST2_SDK/VST2_License_Agreement.pdf
}


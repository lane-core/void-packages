# Template file for 'ion'
pkgname=ion
version=1.0.5.20220903
revision=1
_githash=814ed5a887ad88b98b142af28f653ff4f249de6c
build_style=cargo
hostmakedepends=mdBook
short_desc="Ion shell, written in Rust"
maintainer="Muhammad Herdiansyah <herdiansyah@opmbx.org>"
license="MIT"
homepage="https://github.com/redox-os/ion"
distfiles="${homepage}/archive/${_githash}.tar.gz>${pkgname}-${version}.tar.gz"
checksum=8d29825230fe1497532b9a5c3d851d137af788b0bd112a69dfd159d4981d3891
register_shell="/bin/ion"

#post_patch() {
#	# cannot divide `usize` by `u32`
#	# cargo update --package lexical-core:0.7.4 --precise 0.7.6
#	# cross compilation issues
#	#cargo update --package num-iter:0.1.41 --precise 0.1.43
#	#cargo update --package num-integer:0.1.43 --precise 0.1.45
#	#cargo update --package num-traits:0.2.12 --precise 0.2.15
#}

pre_build() {
	echo ${_githash} > git_revision.txt
}

do_build() {
	cd "${wrksrc}"
    echo "${_commit}" > git_revision.txt
	RUSTUP=0 make
    make manual
    mdbook build -d ../public manual
}

do_install() {
	make install prefix=/usr DESTDIR="${PKGDESTDIR}"
    vmkdir /usr/share/doc
    vcopy ${wrksrc}/public /usr/share/doc/ion
}

post_install() {
	vlicense LICENSE
}
